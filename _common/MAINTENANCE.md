# Self-Maintenance Protocol

コーディネーターが自律的にワークスペースを健全に保つためのプロトコル。

---

## 定期メンテナンス

### メモリメンテナンス

**トリガー**: 10セッションごと、またはユーザー指示時

| タスク | 内容 |
|--------|------|
| Dedup | 同一・類似エントリを統合する |
| Condense | 冗長な記述を簡潔にする |
| Prune | 古い・無効な参照を削除する |
| Limit check | MEMORY.md が60行以内であることを確認する |
| Link verify | トピックファイルへのリンクが有効であることを確認する |

### 実行手順

```
1. MEMORY.md を読む
2. 各トピックファイルを読む
3. 重複エントリを検出 → マージ
4. 古い情報を検出 → 削除 or アーカイブ
5. 行数制限を確認 → 超過分をトピックファイルに分離
6. リンクの整合性を確認
7. 変更があれば書き込み
```

---

## PROJECT.md メンテナンス

**トリガー**: プロジェクト作業の区切り時

| タスク | 内容 |
|--------|------|
| Activity Log | 古いエントリをアーカイブ（直近20件を保持） |
| Known Gotchas | 解決済みの項目を削除 |
| Domain Glossary | 未使用の用語を削除 |
| Architecture Decisions | 撤回された決定にマーク |

---

## ファイル肥大化防止

### 行数制限

| ファイル | 上限 | 超過時のアクション |
|---------|------|------------------|
| MEMORY.md | 60行 | トピックファイルに分離 |
| PROJECT.md Activity Log | 20エントリ | 古いエントリをアーカイブ |
| トピック別ファイル | 200行 | サブトピックに分割 |

### ログローテーション

Activity Log のアーカイブ先:

```
.agents/archive/activity-log-YYYY-MM.md
```

---

## バージョン管理

- ルールファイル（CLAUDE.md、_framework.md）は **gitで管理** する
- 問題が起きたらdiffで変更点を特定できる
- メモリファイルはプロジェクト外（`~/.claude/`）のためgit管理対象外

---

## 自動実行の注意点

- メンテナンスはコーディネーターの責務。エージェントチェーンには含めない
- メンテナンス中はユーザーのタスクを中断しない。タスク完了後に実行する
- 大量の削除・変更が発生する場合はユーザーに確認する

---

## Integration with Guardrails

メンテナンス自体にはガードレールを適用しない（非破壊的操作のため）。
ただし、CLAUDE.md や _framework.md の変更はガードレール L3（確認必須）を適用する。
